# ğŸ¯ å°è¯´ç¬”è®°ç¼–è¾‘ä¸­çš„æ®µè½æ‹–æ‹½ç§»åŠ¨ï¼šåŸºäº ProseMirror çš„äº¤äº’å¼é‡æ’æŠ€æœ¯

> ğŸ’¡ æœ¬æ–‡æ·±å…¥æ¢è®¨äº†åœ¨å°è¯´å†™ä½œè½¯ä»¶çš„ç¬”è®°ç¼–è¾‘å™¨ä¸­å®ç°æ®µè½æ‹–æ‹½ç§»åŠ¨åŠŸèƒ½çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ‹–æ‹½é”šç‚¹ã€å­æ®µè½è”åŠ¨ã€å…¨å±€äº‹ä»¶å¤„ç†ç­‰æ ¸å¿ƒåŠŸèƒ½çš„å®Œæ•´å®ç°ï¼Œä¸ºå¼€å‘è€…æä¾›ä¸€å¥—å®Œæ•´çš„æ®µè½é‡æ’è§£å†³æ–¹æ¡ˆã€‚

## ğŸ“‹ ç›®å½•
- [é¡¹ç›®èƒŒæ™¯](#é¡¹ç›®èƒŒæ™¯)
- [æŠ€æœ¯æ¶æ„è®¾è®¡](#æŠ€æœ¯æ¶æ„è®¾è®¡)
- [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
- [æ‹–æ‹½é”šç‚¹è£…é¥°ç³»ç»Ÿ](#æ‹–æ‹½é”šç‚¹è£…é¥°ç³»ç»Ÿ)
- [æ®µè½ç§»åŠ¨ç®—æ³•](#æ®µè½ç§»åŠ¨ç®—æ³•)
- [å…¨å±€äº‹ä»¶å¤„ç†](#å…¨å±€äº‹ä»¶å¤„ç†)
- [æŠ€æœ¯äº®ç‚¹æ€»ç»“](#æŠ€æœ¯äº®ç‚¹æ€»ç»“)
- [æ€»ç»“ä¸å±•æœ›](#æ€»ç»“ä¸å±•æœ›)

## ğŸ¯ é¡¹ç›®èƒŒæ™¯

åœ¨å°è¯´åˆ›ä½œè¿‡ç¨‹ä¸­ï¼Œä½œè€…ç»å¸¸éœ€è¦è°ƒæ•´ç¬”è®°çš„ç»“æ„å’Œé¡ºåºã€‚ä¼ ç»Ÿçš„æ–‡æœ¬ç¼–è¾‘å™¨é€šå¸¸åªæ”¯æŒå¤åˆ¶ç²˜è´´æ¥ç§»åŠ¨æ®µè½ï¼Œæ“ä½œç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ 51mazi çš„ç¬”è®°ç¼–è¾‘å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªç›´è§‚çš„æ®µè½æ‹–æ‹½ç§»åŠ¨åŠŸèƒ½ï¼Œè®©ä½œè€…èƒ½å¤Ÿé€šè¿‡æ‹–æ‹½å¿«é€Ÿè°ƒæ•´æ®µè½é¡ºåºï¼Œæå‡åˆ›ä½œæ•ˆç‡ã€‚

### ğŸ¨ æ®µè½æ‹–æ‹½åŠŸèƒ½å±•ç¤º

![ç¬”è®°ç¼–è¾‘å™¨](https://raw.githubusercontent.com/xiaoshengxianjun/51mazi/main/static/note-editor.png)

*æ®µè½æ‹–æ‹½ç§»åŠ¨åŠŸèƒ½ - æ”¯æŒæ‹–æ‹½é”šç‚¹å¿«é€Ÿè°ƒæ•´æ®µè½é¡ºåº*

### âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§
- ğŸ–±ï¸ **æ‹–æ‹½é”šç‚¹**: æ¯ä¸ªæ®µè½å·¦ä¾§æ˜¾ç¤ºæ‹–æ‹½é”šç‚¹ï¼ˆâ‹®â‹®ï¼‰ï¼Œæ‚¬åœæ—¶æ˜¾ç¤º
- ğŸ“¦ **å­æ®µè½è”åŠ¨**: æ‹–æ‹½çˆ¶æ®µè½æ—¶ï¼Œæ‰€æœ‰å­æ®µè½ï¼ˆç¼©è¿›çº§åˆ«æ›´å¤§çš„æ®µè½ï¼‰ä¼šä¸€èµ·ç§»åŠ¨
- ğŸ¯ **ç²¾ç¡®å®šä½**: æ”¯æŒåœ¨æ®µè½ä¸Šæ–¹æˆ–ä¸‹æ–¹æ’å…¥ï¼Œæ ¹æ®é¼ æ ‡ä½ç½®è‡ªåŠ¨åˆ¤æ–­
- ğŸŒ **å…¨å±€æ”¯æŒ**: æ”¯æŒæ‹–æ‹½åˆ°ç¼–è¾‘å™¨å¤–çš„åŒºåŸŸï¼ˆå¦‚ä¾§è¾¹æ ï¼‰ï¼Œä»èƒ½æ­£ç¡®æ”¾ç½®
- ğŸ¨ **è§†è§‰åé¦ˆ**: æ‹–æ‹½æ—¶æ˜¾ç¤ºæ®µè½é¢„è§ˆï¼Œæä¾›æ¸…æ™°çš„è§†è§‰åé¦ˆ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **TipTap 3.7.0**: åŸºäº ProseMirror çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ¡†æ¶
- **ProseMirror**: åº•å±‚æ–‡æ¡£æ¨¡å‹å’Œæ’ä»¶ç³»ç»Ÿ
- **Vue 3.5.13**: æ¸è¿›å¼ JavaScript æ¡†æ¶
- **Decoration System**: ProseMirror çš„è£…é¥°ç³»ç»Ÿï¼Œç”¨äºæ·»åŠ æ‹–æ‹½é”šç‚¹

### ç³»ç»Ÿæ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¼–è¾‘å™¨è§†å›¾     â”‚    â”‚   ProseMirror   â”‚    â”‚   æ‹–æ‹½æ‰©å±•      â”‚
â”‚   EditorView    â”‚â—„â”€â”€â–ºâ”‚   Plugin        â”‚â—„â”€â”€â–ºâ”‚ NoteDragHandle  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        æ‹–æ‹½äº‹ä»¶å¤„ç†ä¸æ®µè½ç§»åŠ¨ç®—æ³•                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ æ ¸å¿ƒç»„ä»¶

æ®µè½æ‹–æ‹½åŠŸèƒ½é€šè¿‡ TipTap Extension å®ç°ï¼Œä¸»è¦åŒ…å«ï¼š

- **NoteDragHandle Extension**: æ‹–æ‹½é”šç‚¹æ‰©å±•
- **Decoration System**: è£…é¥°ç³»ç»Ÿï¼Œä¸ºæ¯ä¸ªæ®µè½æ·»åŠ æ‹–æ‹½é”šç‚¹
- **Event Handlers**: å¤„ç†æ‹–æ‹½ç›¸å…³äº‹ä»¶ï¼ˆmousedown, dragstart, dragover, drop, dragendï¼‰

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. æ‹–æ‹½æ‰©å±•åˆå§‹åŒ–

æ®µè½æ‹–æ‹½åŠŸèƒ½é€šè¿‡ TipTap Extension å®ç°ï¼Œåœ¨ç¼–è¾‘å™¨åˆå§‹åŒ–æ—¶æ³¨å†Œï¼š

```javascript
// src/renderer/src/components/NoteEditorContent.vue
import { Extension } from '@tiptap/core'
import { Plugin, PluginKey } from 'prosemirror-state'
import { Decoration, DecorationSet } from 'prosemirror-view'

// æ®µè½æ‹–æ‹½é”šç‚¹æ‰©å±•
const NoteDragHandle = Extension.create({
  name: 'noteDragHandle',
  addProseMirrorPlugins() {
    const key = new PluginKey('note-drag-handle')
    let draggingPos = null // æ‹–æ‹½èµ·ç‚¹ä½ç½®
    
    // æ®µè½ç§»åŠ¨æ ¸å¿ƒç®—æ³•
    function moveParagraphAtPoint(view, clientX, clientY) {
      // ... ç§»åŠ¨é€»è¾‘
    }
    
    return [
      new Plugin({
        key,
        // ... æ’ä»¶é…ç½®
      })
    ]
  }
})
```

### 2. æ‹–æ‹½é”šç‚¹è£…é¥°ç³»ç»Ÿ

ä½¿ç”¨ ProseMirror çš„ Decoration ç³»ç»Ÿä¸ºæ¯ä¸ªæ®µè½æ·»åŠ æ‹–æ‹½é”šç‚¹ï¼š

```javascript
// æ„å»ºè£…é¥°ï¼ˆæ‹–æ‹½é”šç‚¹ï¼‰
function buildDecorations(doc, schema) {
  const decorations = []
  const paragraphType = schema.nodes.noteOutlineParagraph
  
  doc.descendants((node, nodePos) => {
    if (node.type === paragraphType) {
      // ä¸ºæ®µè½æ·»åŠ ç›¸å¯¹å®šä½ç±»
      const nodeDeco = Decoration.node(nodePos, nodePos + node.nodeSize, {
        class: 'has-note-drag-handle'
      })
      decorations.push(nodeDeco)
      
      // åˆ›å»ºæ‹–æ‹½é”šç‚¹å…ƒç´ 
      const handle = document.createElement('span')
      handle.className = 'note-outline-drag-handle'
      handle.dataset.pos = String(nodePos)
      handle.setAttribute('draggable', 'true')
      handle.title = 'æ‹–åŠ¨ä»¥ç§»åŠ¨è¯¥æ®µè½'
      handle.textContent = 'â‹®â‹®'
      
      // å°†é”šç‚¹ä½œä¸º widget æŒ‚è½½åœ¨æ®µé¦–
      const widget = Decoration.widget(nodePos + 1, handle, { side: -1 })
      decorations.push(widget)
    }
    return true
  })
  
  return DecorationSet.create(doc, decorations)
}
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨ `Decoration.node` ä¸ºæ®µè½æ·»åŠ æ ·å¼ç±»
- ä½¿ç”¨ `Decoration.widget` åœ¨æ®µé¦–æ’å…¥æ‹–æ‹½é”šç‚¹
- é€šè¿‡ `dataset.pos` å­˜å‚¨æ®µè½ä½ç½®ï¼Œä¾¿äºåç»­å®šä½

### 3. æ‹–æ‹½äº‹ä»¶å¤„ç†

å¤„ç†æ‹–æ‹½çš„å„ä¸ªé˜¶æ®µäº‹ä»¶ï¼š

```javascript
handleDOMEvents: {
  // é¼ æ ‡æŒ‰ä¸‹ï¼šåˆå§‹åŒ–æ‹–æ‹½
  mousedown: (view, event) => {
    const target = event.target
    if (!target.classList.contains('note-outline-drag-handle')) return false
    
    const pos = Number(target.dataset.pos || -1)
    if (pos < 0) return false
    
    // é€‰ä¸­æ•´ä¸ªæ®µè½èŠ‚ç‚¹
    const node = state.doc.nodeAt(pos)
    const tr = state.tr.setSelection(NodeSelection.create(state.doc, pos))
    view.dispatch(tr)
    
    // è®°å½•æ‹–æ‹½èµ·ç‚¹
    draggingPos = pos
    return true
  },
  
  // æ‹–æ‹½å¼€å§‹ï¼šè®¾ç½®æ‹–æ‹½é¢„è§ˆ
  dragstart: (view, event) => {
    const target = event.target
    if (!target.classList.contains('note-outline-drag-handle')) return false
    
    const pos = Number(target.dataset.pos || -1)
    const nodeDom = view.nodeDOM(pos)
    
    // å…‹éš†èŠ‚ç‚¹ä½œä¸ºæ‹–æ‹½é¢„è§ˆ
    const clone = nodeDom.cloneNode(true)
    clone.style.position = 'fixed'
    clone.style.pointerEvents = 'none'
    clone.style.top = '-10000px'
    // ... è®¾ç½®æ ·å¼
    
    // è®¾ç½®æ‹–æ‹½é¢„è§ˆå›¾
    event.dataTransfer.setDragImage(clone, 8, 8)
    return true
  },
  
  // æ‹–æ‹½æ‚¬åœï¼šå…è®¸æ”¾ç½®
  dragover: (view, event) => {
    if (draggingPos != null) {
      event.preventDefault()
      event.dataTransfer.dropEffect = 'move'
      return true
    }
    return false
  },
  
  // æ”¾ç½®ï¼šæ‰§è¡Œç§»åŠ¨
  drop: (view, event) => {
    if (draggingPos == null) return false
    event.preventDefault()
    moveParagraphAtPoint(view, event.clientX, event.clientY)
    draggingPos = null
    return true
  }
}
```

## ğŸ¯ æ®µè½ç§»åŠ¨ç®—æ³•

### æ ¸å¿ƒç§»åŠ¨é€»è¾‘

æ®µè½ç§»åŠ¨çš„æ ¸å¿ƒç®—æ³•éœ€è¦è€ƒè™‘å¤šä¸ªå› ç´ ï¼š

1. **å­æ®µè½è¯†åˆ«**: è¯†åˆ«éœ€è¦ä¸€èµ·ç§»åŠ¨çš„å­æ®µè½
2. **ç›®æ ‡ä½ç½®è®¡ç®—**: æ ¹æ®é¼ æ ‡ä½ç½®è®¡ç®—æ’å…¥ä½ç½®
3. **è¾¹ç•Œæ£€æŸ¥**: é˜²æ­¢ç§»åŠ¨åˆ°æ— æ•ˆä½ç½®

```javascript
function moveParagraphAtPoint(view, clientX, clientY) {
  const { state } = view
  const rect = view.dom.getBoundingClientRect()
  
  // åæ ‡é™åˆ¶åœ¨ç¼–è¾‘å™¨èŒƒå›´å†…
  const clampedX = Math.max(rect.left + 1, Math.min(clientX, rect.right - 1))
  const clampedY = Math.max(rect.top + 1, Math.min(clientY, rect.bottom - 1))
  
  // è·å–é¼ æ ‡ä½ç½®å¯¹åº”çš„æ–‡æ¡£ä½ç½®
  const posInfo = view.posAtCoords({ left: clampedX, top: clampedY })
  if (!posInfo) return false
  
  const $from = state.doc.resolve(draggingPos)
  const sourceIndex = $from.index(0)
  const sourceNode = state.doc.child(sourceIndex)
  const sourceLevel = sourceNode.attrs.level || 0
  
  // è®¡ç®—ç›®æ ‡ä½ç½®
  const $pos = state.doc.resolve(posInfo.pos)
  let targetIndex = $pos.index(0)
  
  // åˆ¤æ–­æ˜¯æ’å…¥åœ¨æ®µè½ä¸Šæ–¹è¿˜æ˜¯ä¸‹æ–¹
  const domAt = view.nodeDOM($pos.before(1))
  let insertAfter = false
  if (domAt) {
    const tRect = domAt.getBoundingClientRect()
    const midY = tRect.top + tRect.height / 2
    insertAfter = clampedY >= midY
  }
  
  // æŸ¥æ‰¾æ‰€æœ‰éœ€è¦ç§»åŠ¨çš„å­æ®µè½
  let moveCount = 1 // è‡³å°‘ç§»åŠ¨æºæ®µè½æœ¬èº«
  let nextIndex = sourceIndex + 1
  
  while (nextIndex < state.doc.childCount) {
    const nextNode = state.doc.child(nextIndex)
    if (nextNode.type.name === 'noteOutlineParagraph') {
      const nextLevel = nextNode.attrs.level || 0
      // å¦‚æœä¸‹ä¸€æ®µè½çš„å±‚çº§å¤§äºæºæ®µè½ï¼Œè¯´æ˜æ˜¯å­æ®µè½
      if (nextLevel > sourceLevel) {
        moveCount++
        nextIndex++
      } else {
        break // é‡åˆ°åŒçº§æˆ–æ›´é«˜çº§çš„æ®µè½ï¼Œåœæ­¢æŸ¥æ‰¾
      }
    } else {
      break
    }
  }
  
  // æ£€æŸ¥ç›®æ ‡ä½ç½®æ˜¯å¦åœ¨ç§»åŠ¨èŒƒå›´å†…
  if (!insertAfter && targetIndex >= sourceIndex && targetIndex < sourceIndex + moveCount) {
    return true // ä¸éœ€è¦ç§»åŠ¨
  }
  
  // æ‰§è¡Œç§»åŠ¨æ“ä½œ
  const children = []
  state.doc.forEach((child) => {
    children.push(child)
  })
  
  // ç§»é™¤æºæ®µè½åŠå…¶å­æ®µè½
  const movedParagraphs = children.splice(sourceIndex, moveCount)
  
  // è®¡ç®—ç›®æ ‡æ’å…¥ä½ç½®
  let destIndex = targetIndex
  if (sourceIndex < targetIndex) {
    destIndex -= moveCount // è°ƒæ•´ç›®æ ‡ä½ç½®
  }
  
  // åœ¨ç›®æ ‡ä½ç½®æ’å…¥
  if (insertAfter) {
    children.splice(destIndex + 1, 0, ...movedParagraphs)
  } else {
    children.splice(destIndex, 0, ...movedParagraphs)
  }
  
  // åˆ›å»ºæ–°æ–‡æ¡£å¹¶åº”ç”¨å˜æ›´
  const newDoc = state.doc.type.create(state.doc.attrs, Fragment.from(children))
  const tr = state.tr.replaceWith(0, state.doc.content.size, newDoc.content)
  view.dispatch(tr.scrollIntoView())
  return true
}
```

**ç®—æ³•è¦ç‚¹**ï¼š
- **å­æ®µè½è¯†åˆ«**: é€šè¿‡æ¯”è¾ƒ `level` å±æ€§è¯†åˆ«å­æ®µè½
- **ä½ç½®è®¡ç®—**: æ ¹æ®é¼ æ ‡ Y åæ ‡åˆ¤æ–­æ’å…¥ä½ç½®ï¼ˆä¸Šæ–¹/ä¸‹æ–¹ï¼‰
- **è¾¹ç•Œå¤„ç†**: é˜²æ­¢ç§»åŠ¨åˆ°è‡ªèº«èŒƒå›´å†…
- **æ–‡æ¡£é‡å»º**: ä½¿ç”¨ Fragment é‡å»ºæ–‡æ¡£ç»“æ„

## ğŸŒ å…¨å±€äº‹ä»¶å¤„ç†

ä¸ºäº†æ”¯æŒæ‹–æ‹½åˆ°ç¼–è¾‘å™¨å¤–çš„åŒºåŸŸï¼ˆå¦‚ä¾§è¾¹æ ï¼‰ï¼Œéœ€è¦ç›‘å¬å…¨å±€äº‹ä»¶ï¼š

```javascript
view(editorView) {
  let lastPoint = null
  
  // å…¨å±€æ”¾ç½®äº‹ä»¶
  const onDocDrop = (e) => {
    if (draggingPos == null) return
    e.preventDefault()
    moveParagraphAtPoint(editorView, e.clientX, e.clientY)
    draggingPos = null
  }
  
  // å…¨å±€æ‹–æ‹½æ‚¬åœäº‹ä»¶
  const onDocDragOver = (e) => {
    if (draggingPos == null) return
    e.preventDefault()
    lastPoint = { x: e.clientX, y: e.clientY }
  }
  
  // å…¨å±€æ‹–æ‹½ç»“æŸäº‹ä»¶ï¼ˆå…œåº•å¤„ç†ï¼‰
  const onDocDragEnd = () => {
    if (draggingPos != null && lastPoint) {
      // å¦‚æœæ²¡æœ‰è§¦å‘ dropï¼Œä¹Ÿåœ¨ dragend æ—¶æ‰§è¡Œç§»åŠ¨
      moveParagraphAtPoint(editorView, lastPoint.x, lastPoint.y)
    }
    draggingPos = null
    lastPoint = null
  }
  
  // æ³¨å†Œå…¨å±€äº‹ä»¶ç›‘å¬
  document.addEventListener('drop', onDocDrop)
  document.addEventListener('dragover', onDocDragOver)
  document.addEventListener('dragend', onDocDragEnd)
  
  return {
    destroy() {
      // æ¸…ç†äº‹ä»¶ç›‘å¬
      document.removeEventListener('drop', onDocDrop)
      document.removeEventListener('dragover', onDocDragOver)
      document.removeEventListener('dragend', onDocDragEnd)
    }
  }
}
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨ `document` çº§åˆ«çš„äº‹ä»¶ç›‘å¬ï¼Œè¦†ç›–æ•´ä¸ªé¡µé¢
- åœ¨ `dragend` ä¸­å…œåº•å¤„ç†ï¼Œç¡®ä¿å³ä½¿æ²¡æœ‰è§¦å‘ `drop` ä¹Ÿèƒ½å®Œæˆç§»åŠ¨
- åœ¨æ’ä»¶é”€æ¯æ—¶æ¸…ç†äº‹ä»¶ç›‘å¬ï¼Œé¿å…å†…å­˜æ³„æ¼

## ğŸ¨ æ ·å¼è®¾è®¡

æ‹–æ‹½é”šç‚¹çš„æ ·å¼è®¾è®¡éœ€è¦è€ƒè™‘ç”¨æˆ·ä½“éªŒï¼š

```scss
// æ‹–æ‹½é”šç‚¹æ ·å¼
.note-outline-drag-handle {
  width: 12px;
  height: 12px;
  cursor: grab !important;
  font-size: 10px;
  color: var(--text-mute, #999);
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  
  // æ‚¬åœæ—¶æ˜¾ç¤º
  &:hover {
    cursor: grab !important;
    color: var(--text-base, #333);
  }
  
  // æ‹–æ‹½æ—¶æ˜¾ç¤ºæŠ“å–æ‰‹åŠ¿
  &:active {
    cursor: grabbing !important;
  }
}

// æ®µè½æ‚¬åœæ—¶æ˜¾ç¤ºæ‹–æ‹½é”šç‚¹
p[data-note-outline]:hover {
  .note-outline-drag-handle {
    opacity: 1;
    pointer-events: auto;
  }
}
```

## ğŸ¯ æŠ€æœ¯äº®ç‚¹æ€»ç»“

### 1. åŸºäº ProseMirror æ’ä»¶ç³»ç»Ÿ
- **æ‰©å±•æ€§å¼º**: é€šè¿‡ Extension æœºåˆ¶ï¼Œæ˜“äºé›†æˆå’Œç»´æŠ¤
- **æ€§èƒ½ä¼˜ç§€**: åˆ©ç”¨ ProseMirror çš„æ–‡æ¡£æ¨¡å‹ï¼Œç§»åŠ¨æ“ä½œé«˜æ•ˆ
- **çŠ¶æ€ç®¡ç†**: è‡ªåŠ¨å¤„ç†æ–‡æ¡£å˜æ›´å’Œè£…é¥°æ›´æ–°

### 2. å­æ®µè½è”åŠ¨æœºåˆ¶
- **æ™ºèƒ½è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å­æ®µè½ï¼ˆé€šè¿‡ level å±æ€§ï¼‰
- **æ‰¹é‡ç§»åŠ¨**: çˆ¶æ®µè½ç§»åŠ¨æ—¶ï¼Œæ‰€æœ‰å­æ®µè½ä¸€èµ·ç§»åŠ¨
- **ç»“æ„ä¿æŒ**: ä¿æŒæ®µè½å±‚çº§å…³ç³»ä¸å˜

### 3. å…¨å±€äº‹ä»¶æ”¯æŒ
- **è·¨åŒºåŸŸæ‹–æ‹½**: æ”¯æŒæ‹–æ‹½åˆ°ç¼–è¾‘å™¨å¤–çš„åŒºåŸŸ
- **å…œåº•å¤„ç†**: åœ¨ dragend ä¸­å¤„ç†æœªè§¦å‘ drop çš„æƒ…å†µ
- **äº‹ä»¶æ¸…ç†**: æ’ä»¶é”€æ¯æ—¶è‡ªåŠ¨æ¸…ç†äº‹ä»¶ç›‘å¬

### 4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **è§†è§‰åé¦ˆ**: æ‹–æ‹½æ—¶æ˜¾ç¤ºæ®µè½é¢„è§ˆ
- **ç²¾ç¡®å®šä½**: æ ¹æ®é¼ æ ‡ä½ç½®åˆ¤æ–­æ’å…¥ä½ç½®
- **è¾¹ç•Œä¿æŠ¤**: é˜²æ­¢ç§»åŠ¨åˆ°æ— æ•ˆä½ç½®

## ğŸ”® æ€»ç»“ä¸å±•æœ›

æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†åœ¨å°è¯´å†™ä½œè½¯ä»¶çš„ç¬”è®°ç¼–è¾‘å™¨ä¸­å®ç°æ®µè½æ‹–æ‹½ç§»åŠ¨åŠŸèƒ½çš„æŠ€æœ¯æ–¹æ¡ˆã€‚é€šè¿‡ ProseMirror çš„æ’ä»¶ç³»ç»Ÿã€Decoration è£…é¥°ç³»ç»Ÿå’Œç²¾å¿ƒè®¾è®¡çš„ç§»åŠ¨ç®—æ³•ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€ç”¨æˆ·ä½“éªŒä¼˜ç§€çš„æ®µè½é‡æ’åŠŸèƒ½ã€‚

### æŠ€æœ¯ä¼˜åŠ¿
- âœ… **åŸºäºæ ‡å‡†**: ä½¿ç”¨ ProseMirror æ ‡å‡† APIï¼Œç¨³å®šå¯é 
- âœ… **æ€§èƒ½ä¼˜ç§€**: åˆ©ç”¨æ–‡æ¡£æ¨¡å‹ï¼Œç§»åŠ¨æ“ä½œé«˜æ•ˆ
- âœ… **æ‰©å±•æ€§å¼º**: æ˜“äºæ‰©å±•å’Œç»´æŠ¤
- âœ… **ç”¨æˆ·å‹å¥½**: ç›´è§‚çš„æ‹–æ‹½æ“ä½œï¼Œæ”¯æŒå­æ®µè½è”åŠ¨

### æœªæ¥ä¼˜åŒ–æ–¹å‘
- ğŸ”® **åŠ¨ç”»æ•ˆæœ**: æ·»åŠ å¹³æ»‘çš„ç§»åŠ¨åŠ¨ç”»
- ğŸ”® **å¤šé€‰æ‹–æ‹½**: æ”¯æŒåŒæ—¶æ‹–æ‹½å¤šä¸ªæ®µè½
- ğŸ”® **æ’¤é”€é‡åš**: ä¼˜åŒ–æ’¤é”€é‡åšæœºåˆ¶
- ğŸ”® **é”®ç›˜å¿«æ·é”®**: æ”¯æŒé”®ç›˜å¿«æ·é”®ç§»åŠ¨æ®µè½

é€šè¿‡è¿™å¥—æŠ€æœ¯æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¸ºå°è¯´åˆ›ä½œè€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§è€Œç›´è§‚çš„æ®µè½é‡æ’å·¥å…·ï¼Œå¤§å¤§æå‡äº†ç¬”è®°æ•´ç†çš„æ•ˆç‡ã€‚

---

### ğŸ“š ç›¸å…³é“¾æ¥
- **é¡¹ç›®åœ°å€**: [GitHub - 51mazi](https://github.com/xiaoshengxianjun/51mazi)ï¼Œç»™ä¸ª Star å“¦~
- **TipTap å®˜ç½‘**: [https://tiptap.dev](https://tiptap.dev)
- **ProseMirror æ–‡æ¡£**: [https://prosemirror.net](https://prosemirror.net)

### ğŸ·ï¸ æ ‡ç­¾
`#ProseMirror` `#TipTap` `#æ®µè½æ‹–æ‹½` `#Vue3` `#Electron` `#å°è¯´å†™ä½œ` `#å¯Œæ–‡æœ¬ç¼–è¾‘` `#å‰ç«¯å¼€å‘`

---

> ğŸ’¡ **å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ æ”¯æŒä¸€ä¸‹ï¼**

